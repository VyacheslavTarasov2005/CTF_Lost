# CTF Задача: LOST Secret Key

## Описание

В этом веб-приложении Flask разработчик, вдохновлённый [ДАННЫЕ УДАЛЕНЫ], спрятал флаг админа. Используйте подсказки, скрытые в числах и ссылках, чтобы найти секретный ключ и получить доступ к учётной записи администратора, откуда можно получить флаг.

## Легенда

Разработчик этого приложения был настоящим фанатом [ДАННЫЕ УДАЛЕНЫ]. В его коде спрятаны загадочные числа и намёки, которые могут помочь вам найти нечто очень важное — секретный ключ. Сможете ли вы разгадать загадку и получить доступ к скрытому флагу?

## Теги

`web` `flask` `session` `cookie` `secret-key` `LOST`

## Сложность: 
`Easy`

### Описание эндпойнтов

- `/` — главная страница.  
  Если вы залогинены как `admin` — показывается содержимое файла `flag.txt`.  
  Если залогинен обычный пользователь — показывается приветствие с ролью
  Если не залогинен — возвращается форма для входа.

- `/register` — POST-эндпойнт для получения куки
  Принимает форму с полями `username` и `password`. Устанавливает сессию.

- `/logout` — разлогинивание пользователя и очистка сессии.

- `/<int:id>` — страницы с разным контентом
  В зависимости от введённого числа показывает разные сообщения, в числе которых спрятан секретный ключ приложения.

---

## Инструкция по развертыванию (для администраторов)

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Скопируйте исходники приложения и положите файл `flag.txt` рядом с `app.py` с содержимым вашего флага, например:
3. Запустите команду:
```bash
  docker-compose up -d --build
```

## Как решить задачу
1. Зарегистрируйтесь
2. Проанализируйте куки (можно сделать вывод, что используются flask куки сессии)
3. Дешифруйте куки (в куках записана роль пользователя)
4. Исследуйте эндпойнт с id
5. По рандомному id можно увидеть сообщение с ссылкой на сериал Lost на кинопоиске
6. Вставляем id из ссылки в url, видим сообщение "The plane"
7. Гуглим про самолет из сериала, узнаем, что это был рейс 815
8. Вставляем 815 в url, видим "Don't forget to enter the numbers", гуглим про числа из сериала, находим код 4815162342
9. Вставляем код в url
10. Видим сообщение с выделенными словами CODE, ELEMENT, открываем код элемента, находим в комментария секретный ключ verysecretkeyplzdonthack
11. Используйте полученный секретный ключ для генерации поддельной cookie сессии с полем role = admin (можно использовать powershell команду flask-unsign --sign --cookie '{\"role\":\"admin\"}' --secret 'verysecretkeyplzdonthack').
12. Подставьте эту cookie в браузере и получите доступ к флагу **HITS{SUPERMEGAULTRAFLAG}** на главной странице